
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Chatbot T∆∞ V·∫•n Du H·ªçc</title>
  <style>
    .chat-button {
      position: fixed;
      bottom: 40px;
      right: 20px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      z-index: 1001;
    }

    .chat-box {
      position: fixed;
      bottom: 40px;
      right: 90px;
      width: 300px;
      max-height: 400px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 10px;
      display: none;
      flex-direction: column;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      z-index: 1000;
    }

    .chat-header {
      padding: 10px;
      background-color: #007bff;
      color: white;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      font-weight: bold;
    }

    .chat-body {
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .chat-footer {
      padding: 10px;
      border-top: 1px solid #ddd;
    }

    .chat-footer input {
      width: 94%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .message {
      max-width: 80%;
      padding: 6px 10px;
      border-radius: 10px;
      display: inline-block;
      word-wrap: break-word;
    }

    .user-message {
      background-color: #e1f5fe;
      align-self: flex-end;
      text-align: right;
    }

    .bot-message {
      background-color: #f1f1f1;
      align-self: flex-start;
      text-align: left;
    }
  </style>
</head>
<body>
<!-- N√∫t b·∫•m icon chat -->
 <button class="chat-button" onclick="toggleChat()">üí¨</button>

<div class="chat-box" id="chatBox">
  <div class="chat-header">H·ªó tr·ª£</div>
  <div class="chat-body" id="chatBody">
    <div class="message bot-message">Ch√†o b·∫°n! T√¥i l√† tr·ª£ l√Ω t∆∞ v·∫•n du h·ªçc Song Nguy√™n.</div>
    <div class="message bot-message">
      T√¥i c√≥ th·ªÉ h·ªó tr·ª£ b·∫°n tr·ª±c ti·∫øp ho·∫∑c b·∫°n c√≥ th·ªÉ ch·ªçn c√°c n·ªôi dung:
      <br>1Ô∏è‚É£ N∆∞·ªõc du h·ªçc
      <br>2Ô∏è‚É£ Ng√†nh h·ªçc
      <br>3Ô∏è‚É£ Ngu·ªìn h·ªçc b·ªïng
    </div>
  </div>
  <div class="chat-footer">
    <input type="text" id="userInput" placeholder="Nh·∫≠p tin nh·∫Øn..." onkeydown="handleInput(event)">
  </div>
</div>

<script>
  function showMainMenu() {
   const chatBody = document.getElementById('chatBody');
   if (!chatBody) return;
 
   const menuDiv = document.createElement('div');
   menuDiv.className = "message bot-message";
   menuDiv.innerHTML = `
     T√¥i c√≥ th·ªÉ h·ªó tr·ª£ b·∫°n tr·ª±c ti·∫øp ho·∫∑c b·∫°n c√≥ th·ªÉ ch·ªçn c√°c n·ªôi dung:
     <br>1Ô∏è‚É£ N∆∞·ªõc du h·ªçc
     <br>2Ô∏è‚É£ Ng√†nh h·ªçc
     <br>3Ô∏è‚É£ Ngu·ªìn h·ªçc b·ªïng
   `;
 
   chatBody.appendChild(menuDiv);
   chatBody.scrollTop = chatBody.scrollHeight;
 }
 </script>
 <script>
   function toggleChat() {
     const chat = document.getElementById('chatBox');
     chat.style.display = chat.style.display === 'flex' ? 'none' : 'flex';
   }
 
   function handleInput(event) {
     if (event.key === "Enter") {
       const input = document.getElementById('userInput');
       const message = input.value.trim();
       if (message) {
         appendMessage("user", message);
         input.value = "";
         sendToBot(message);
       }
     }
   }
 
   function appendMessage(sender, message) {
     const chatBody = document.getElementById('chatBody');
     const msg = document.createElement('div');
     msg.className = `message ${sender === "user" ? "user-message" : "bot-message"}`;
 
   // N·∫øu l√† bot, t·ª± ƒë·ªông chuy·ªÉn xu·ªëng d√≤ng cho c√°c d·∫•u g·∫°ch ƒë·∫ßu d√≤ng
   if (sender === "bot") {
     message = message
       .replace(/\n/g, "<br>")                      // Xu·ªëng d√≤ng theo l·ªánh \n           
   }
 
   msg.innerHTML = message;
   chatBody.appendChild(msg);
   chatBody.scrollTop = chatBody.scrollHeight;
 
   }
  
   async function sendToBot(message) {
     if (!chatBody) return;
 
   // Ki·ªÉm tra c√°c l·ª±a ch·ªçn ƒë∆°n gi·∫£n tr∆∞·ªõc khi g·ªçi API
   const trimmed = message.trim();
   if (["1", "2", "3"].includes(trimmed)) {
     let reply = "";
     if (trimmed === "1") reply = "B·∫°n mu·ªën t√¨m hi·ªÉu v·ªÅ du h·ªçc ·ªü ch√¢u l·ª•c ho·∫∑c qu·ªëc gia n√†o? V√≠ d·ª•: Ch√¢u l·ª•c: Ch√¢u √Çu, Ch√¢u M·ªπ; Qu·ªëc gia: M·ªπ, Canada...";
     if (trimmed === "2") reply = "B·∫°n quan t√¢m ƒë·∫øn ng√†nh h·ªçc n√†o? V√≠ d·ª•: C√¥ng ngh·ªá th√¥ng tin, Kinh doanh, Y khoa...";
     if (trimmed === "3") reply = "B·∫°n mu·ªën t√¨m hi·ªÉu h·ªçc b·ªïng t·ª´ ch√≠nh ph·ªß, tr∆∞·ªùng ƒë·∫°i h·ªçc hay t·ªï ch·ª©c n√†o?";
     appendMessage("bot", reply);
     return;
   }
     // üëâ N·∫øu ng∆∞·ªùi d√πng g√µ "menu" ‚Üí hi·ªán l·∫°i menu
     if (trimmed.toLowerCase() === "menu") {
     showMainMenu();
     return;
   }
 
     const loadingMsg = document.createElement('div');
     loadingMsg.className = "message bot-message";
     loadingMsg.textContent = "ü§ñ ƒêang x·ª≠ l√Ω...";
     loadingMsg.id = "loading-message";
     chatBody.appendChild(loadingMsg);
     chatBody.scrollTop = chatBody.scrollHeight;
 
     try {
       const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
         method: "POST",
         headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer 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",
          "HTTP-Referer": "https://nghiacao1.github.io/duhoc-chatbot",
          "X-Title": "Test Chatbot"
        },
         body: JSON.stringify({
           model: "openai/gpt-3.5-turbo",
           // max_tokens: 500,
           messages: [
             {
         role: "system",
         content: "B·∫°n l√† chuy√™n gia t∆∞ v·∫•n du h·ªçc. Ch·ªâ tr·∫£ l·ªùi c√°c c√¢u h·ªèi li√™n quan ƒë·∫øn du h·ªçc. QUY T·∫ÆC TR·∫¢ L·ªúI:- Tr·∫£ l·ªùi ng·∫Øn g·ªçn, r√µ r√†ng, kh√¥ng v∆∞·ª£t qu√° 4-5 √Ω m·ªói l·∫ßn.- Tr√¨nh b√†y t·ª´ng √Ω b·∫±ng d·∫•u g·∫°ch ƒë·∫ßu d√≤ng (-) ho·∫∑c s·ªë th·ª© t·ª± (1., 2., 3.)- Kh√¥ng ƒë∆∞a ra qu√° nhi·ªÅu th√¥ng tin m·ªôt l√∫c. N·∫øu c√¢u tr·∫£ l·ªùi d√†i, ch·ªâ tr·∫£ l·ªùi ph·∫ßn ƒë·∫ßu v√† g·ª£i √Ω ng∆∞·ªùi d√πng h·ªèi ti·∫øp.- Tr√°nh l·∫∑p l·∫°i, tr√°nh vƒÉn b·∫£n d√†i li·ªÅn m·∫°ch qu√° 5 d√≤ng.- N·∫øu ng∆∞·ªùi d√πng h·ªèi r·ªông, h√£y chia nh·ªè c√¢u h·ªèi v√† h·ªèi l·∫°i h·ªç mu·ªën bi·∫øt ph·∫ßn n√†o tr∆∞·ªõc."
           },
           { role: "user", content: message }]
         })
       });
       const data = await response.json();
 
     console.log("üî• Ph·∫£n h·ªìi t·ª´ OpenRouter:", data); // Debug xem c√≥ g√¨ tr·∫£ v·ªÅ
 
     const loadingElem = document.getElementById("loading-message");
     if (loadingElem) loadingElem.remove();
 
     if (response.ok && data.choices && data.choices.length > 0 && data.choices[0].message?.content) {
       const reply = data.choices[0].message.content;
       appendMessage("bot", reply);
     } else {
       appendMessage("bot", "ü§ñ Xin l·ªói, hi·ªán t·∫°i t√¥i ch∆∞a c√≥ ph·∫£n h·ªìi ph√π h·ª£p.");
     }
   } catch (error) {
     const loadingElem = document.getElementById("loading-message");
     if (loadingElem) loadingElem.remove();
     appendMessage("bot", "‚ö†Ô∏è C√≥ l·ªói khi k·∫øt n·ªëi v·ªõi chatbot.");
     console.error("‚ùå L·ªói fetch:", error);
   }
   const reply = data.choices?.[0]?.message?.content || "Kh√¥ng c√≥ ph·∫£n h·ªìi.";
 
 // C·∫Øt ƒëo·∫°n qu√° d√†i (v√≠ d·ª•: 1000 k√Ω t·ª±)
 const maxLength = 700;
 const finalReply = reply.length > maxLength ? reply.slice(0, maxLength) + "...\n‚úÇÔ∏è Tr·∫£ l·ªùi qu√° d√†i, b·∫°n mu·ªën xem ti·∫øp kh√¥ng?" : reply;
 
 appendMessage("bot", finalReply);
 
}
</script>
</body>
</html>
